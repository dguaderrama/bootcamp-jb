---
title: "QGIS"
layout: post
category : Applications
tagline: "Supporting tagline"
tags : [applications, qgis, quantumgis]
---

{% include JB/setup %}

<a title="By User:Anitagraser on QGIS Wiki, User:Anitagraser (http://www.qgis.org/wiki/File:QGis_Logo.png) [CC BY-SA 3.0 (http://creativecommons.org/licenses/by-sa/3.0)], via Wikimedia Commons" href="http://commons.wikimedia.org/wiki/File%3AQGis_Logo.png"><img width="128" alt="QGis Logo" src="//upload.wikimedia.org/wikipedia/commons/thumb/7/71/QGis_Logo.png/128px-QGis_Logo.png"/></a>

# What is QGIS?

> QGIS is the best GIS tool in the free and open-source software (FOSS) community.

> QGIS is a user friendly Open Source Geographic Information System (GIS) licensed under the GNU General Public License. QGIS is an official project of the Open Source Geospatial Foundation (OSGeo). It runs on Linux, Unix, Mac OSX, Windows and Android and supports numerous vector, raster, and database formats and functionalities.

[Here's a link to download QGIS](http://www2.qgis.org/en/site/forusers/download.html)

<br>

## Exlpore QGIS:

For a more thorough explanation of QGIS, <a href="http://docs.qgis.org/2.6/en/docs/user_manual/" target="new">see the QGIS User Guide here</a>.

## The Basics

  ![QGIS GUI]({{site.baseurl}}{{ASSET_PATH}}/images/qgis-gui.png)

1. **Menu Bar**
The menu bar provides access to QGIS features. In Linux systems, hover over to view menu bar options (haven't checked other systems). The QGIS version is displayed while not hovering over the menu bar (linux systems). Most common features or tools are accessable through the toolbar icons which will be the prefered method throughout this QGIS introduction.
2. **Toolbar**
The toolbar provides access to most standard QGIS functions. Go to <em>Menu Bar > View > Toolbars</em> to activate or deactivate toolbars. Hover over tools to view the description and puropose.
3. **Map Legend**
The map legend is a list of all layers in the project. Each layer can be turned on or off with the layer's checkbox.  It's possible to group layers.
4. **Map View**
The map view displays the active layers in the map project. You can set the map view extent by right-clicking on a layer and selecting <em>Zoom to layer extent</em>
5. **Status Bar**
The status bar displays current position in map coordiantes (e.g., meters or decimal degrees) as the mouse pointer moves across the map view. To the left of the coordinate display is the button gor toggling extents and mouse position display. To the right of the map coordinates is the scale, which may be set to one of the predefined zoom extends of 1:500 to 1:1,000,000. This scale setting will adjust as you zoom or pan throught the map view. Options for map rendering are to the right of the current map scale setting. To the far right is the current CRS for the map project.
6. **Processing Toolbox**
The processing toolbox must be turned on by naviagting to <em>Menu Bar > Processing > Toolbox</em>. This helpful tool allows searching by keyword for the geoalgorithm from each of the active processing roviders.[^2]

----

<br>

## Configure your workspace

### Project properties

  ![QGIS Project Properties]({{site.baseurl}}{{ASSET_PATH}}/images/project-properties.jpg)

<em>Menu Bar > Project > Project Properties</em>

From here you can set the title, save relative paths (default!), set canvas units, enable on-the-fly projection, etc. On-the-fly projection will project layers added to the project to the configured projection. 


### Activate necessary providers

  ![Activate Providers]({{site.baseurl}}{{ASSET_PATH}}/images/providers-config.jpg)

<em>Menu Bar > Processing > Options and configuration > Providers > $PROVIDER > Activate (be sure it's checked)</em>

[See the complete list of processing providers and algorithms here](http://docs.qgis.org/2.6/en/docs/user_manual/processing_algs/index.html?highlight=providers)

----

<br>

## Working with Project Projections

> QGIS allows users to define a global and project-wide CRS (coordinate reference system) for layers without a pre-defined CRS. It also allows the user to define custom coordinate reference systems and supports on-the-fly (OTF) projection of vector and raster layers. All of these features allow the user to display layers with different CRSs and have them overlay properly.[^2]

See [Intro to Spatial Data]({{site.baseurl}}/intro/spatial-data) for more detailed info on projections.

Each new project starts with the global default projection, [EPSG:4326 - WGS 84](http://www.spatialreference.org/epsg/wgs-84/): 

``proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs``

This can be changed at <em>Menu Bar > Settings > Options > CRS > Default CRS for new projects</em>

However, this is not the same as changing the project projection. You may define the project projection from <em>Menu Bar > Project > Project Properties > CRS</em>. Also keep in mind, the CRS of a new project will change to the CRS of the first layer added to the project.

'On the fly' CRS transformation is not enabled by the default QGIS installation.  

## Supported Data Formats

QGIS support a multitude of data types from simple shapefiles to database tables to Web Feature Service layers. Sticking to the basics, below are quick descriptions of vector and raster data.

### Vector 

QGIS uses the GDAL OGR library to read and write vector data formats, such as the most commonly known ESRI shapefile. GRASS vector and PostreSQL support is provided by a native QGIS provider plugin[^2]. [Here is the complete list of OGR vector formats](http://www.gdal.org/ogr_formats.html).

Vector data is added to the project by simply clicking on the Add Vector Layer tool:

![Add vector in QGIS]({{site.baseurl}}{{ASSET_PATH}}/images/add-vector.png)

View vector attribute table by right clicking on the layer and clicking Open Attribute Table. From here you can sort data, show selected features, show features visible on map, show edited and new features, filter by column, or query data with and advanced filter. 

Attribute data can be edited by enabling and edit session with the Toggle Editing Mode icon (top left).

### Raster

QGIS uses the GDAL library to read and write raster data formats while GRASS raster support is provided by a native QGIS provider plugin[^2]. [Here is the complete list of GDAL raster formats](http://www.gdal.org/formats_list.html).

Similar to adding vector data, click on the Add Raster Layer tool:

 ![Add raster in QGIS]({{site.baseurl}}{{ASSET_PATH}}/images/add-raster.png)

## General Spatial Functions

Spatial functions are accessable through <em>Menu Bar > Vector/Raster</em>. Or alternatively, they are accesses through the Toolbox panel where searching for tools by keyword is made easy. 

## Composing Maps (for print/non-web-based)

This method is ideal for exporting your work for a research paper, admiring your work, and such. Developing a web map for dissimenating your data is a bit more involved and is discussed in the [Publish Your Data to a Web Mapi/LeafletJS]({{site.baseurl}}/visualization/leaflet) section. Also, to export data with styles see [This section link](this-is-not-a-link).

Begin by opening the Print Composer: 

 ![Create new Print Composer workspace]({{site.baseurl}}{{ASSET_PATH}}/images/compose-map.png)

<br>

----

<br>

# Lessons

Lessons are intended for learning basic spatial functions with QGIS. Each lesson is a prerequisite for the subsequent lesson. For best results, start from beginning to end from collecting data throught visualizing the final product. However, data will be prepared and available if you wish to jump through lessons without completing the former.

DISCLAIMER: Data provided here have been reclassified/modified to fit the needs of the lessons and should not be used in any scientific analysis. Original data sources and researh articles are available if you feel the need to pursue your dreams of performing a landslide susceptibility analysis. [Original data and research articles are located here]({{site.baseurl}}/references/citations).

## The Scenario:

You've been assigned the task of locating high-risk landslide areas in the state of Washington, specifically the densely population northwest region. You must locate and prepare your data before performing your analysis. The Governor of Washington also wants to make this data publicaly through an online web map. 

<br>

----

<br>

## Data Collection

### What this lesson covers:

 * downloading data
 * downloading meta data
 * file storage/project directory (keep your data directories clean)

### Objective:

Gather data necessary for locating high-risk landslide areas in the state of Washington. 

### Data sources:

 * GTOPO30
 * Washington boundary
 * Washington geology
 * [American Fact Finder (real estate)](http://factfinder.census.gov/)
 * [TIGER/Line (shapefiles and geodatabases)](http://www.census.gov/geo/maps-data/data/tiger-line.html)

### Steps: 

 1. prepare project directory
  * this is intended for a best practice
  * create folder structure
 1. how to download gtopo30
  * explain
 2. how to download washington boundary
  * explain
 3. how to download washington geology
  * explain
 

 * download data with meta data (DEM & washingon boundary data with meta data)
 * prepare project directory
 * data will be used in Data Prep

<br>

----

<br>

## Data Wrangling - Prepare Digital Elevation Model

### What this lesson covers:

 * reprojecting data
 * clipping data extents
 * importing data (raster and vector)

### Objective: 

Download, examine, and prepare DEM for landslide susceptibility analysis.

### Data:

 * gtopo30 DEM - northwest america

### Steps:

 * import DEM of northwest US
 * import washington boundary shapefile
 * clip DEM to washington boundary
 * data will be used in Reclassify and Rasterize Vector

<br>

----

<br>

## Data Wrangling - Reclassify and Rasterize Vector

### What this module covers: 

 * editing vector data attributes
 * (re)classifying vector data
 * rasterizing vector data

### Objective

Prepare geology layer with geo_type (just an example) of soft, medium, hard, mass-wasting

### Data:

 * washington state geology shapefile

### Steps: 

 1.  Import wa_geology.shp:
   * <em>Open QGIS, Add Vector Layer, and navigate to wa_geology.shp.</em><br>
![QGIS: Add geology vector layer into map view]({{site.baseurl}}{{ASSET_PATH}}/images/lesson-1/lesson-1-01.png)
 2.  Open field calculator in Attribute Table:
   * <em>Right-click wa_geology in Layers List > Open Attribute Table > Toggle editing mode (top left)</em>
   * While in edit mode, <em>Open field calculator (top right)</em><br>
![QGIS: Open field calcultor]({{site.baseurl}}{{ASSET_PATH}}/images/lesson-1/lesson-1-03.png)
 3.  Add and calculate new field:
   * Match your Field Calculator window to the one below for creating a new field 'strength' with a range of values of 0-3. Be sure to match it exactly as it's displayed: *double-quotes are evaluated as a column whereas single-quotes are evaluated as column values. Save your changes once finished*.<br><br>**Expression:<br>case<br>when "rock_type" = 'soft' then 1<br>when "rock_type" = 'medium' then 2<br>when "rock_type" = 'hard' then 3<br>else 0<br>done<br>**
![QGIS: Add and calculate new field]({{site.baseurl}}{{ASSET_PATH}}/images/lesson-1/lesson-1-04.png)
 4. Style wa_geology.shp:
   * <em>Right-click on wa_geology.shp in layer list > Properties > Style</em>
   * Change style type from <em>Single Symbol</em> to <em>Categorized</em>.
   * Categorize by <em>strength</em> and click <em>Classify</em> to add classes.
   * Match your colors with the example below or get fancy with your own styling.<br>
![QGIS: Style shapefile]({{site.baseurl}}{{ASSET_PATH}}/images/lesson-1/lesson-1-07.png)
 5. Rasterize wa_geology.shp:
   * GDAL's rasterize is a prefered method. This can be accessed through <em>Menu Bar > Raster > Conversion > Rasterize (Vector to raster)</em>. Notice how the parameters have been diabled in the example below. There's a specific reason for this. Complete the parameter inputs: <em>Define your output file and location (in working directory); Attribute field = strength; Raster size in pixels = 1000 x 1000</em>. Because GDAL is more powerful in the commandline, there are certain parameters that cannot be set within QGIS.
   * <em>Click the edit icon (pencil) locate near the block of code</em>. This enables you to add those non-QGIS parameters.
   * <em>Add the line of code</em> ``-at -a_nodata 0`` just after ``gdal_rasterize`` 
   * <em>-at</em>: Enables the ALL_TOUCHED rasterization option so that all pixels touched by lines or polygons will be updated, not just those on the line render path, or whose center point is within the polygon. Defaults to disabled for normal rendering rules.[^3]
   * <em>-a_nodata $value</em>: Assign a specified nodata value to output bands - this prevents pixels with no data from being written into the output raster.[^3]
   * [Here's a link to the gdal_rasterize parameters](http://www.gdal.org/gdal_rasterize.html).<br>
   ![QGIS: Rasterize - Vector to raster]({{site.baseurl}}{{ASSET_PATH}}/images/lesson-1/lesson-1-11-2.png)
 6. Style the new wa_geology.tif:
   * Open wa_geology.tif style properties. HINT: See step 4.
   * For <em>Render type</em>, select <em>Singleband pseudocolor</em>
   * On the right select: <em>Load min/max values: Min/max; Extend: Actual (slower); then Load</em>. This loads actual values into the classification. QGIS Approximates values by defautl. 
   * <em>Change Mode to Equal Interval with 3 classes</em>. Remember, we only have three rock strength classes: soft, medium, hard. Change your color map if you'd like. The color maps are not stored into the raster, so the raster will load with the defaul color map (black to white) each time its opened in a new project.
   * <em>Click Classify</em>. Apply and OK.<br>
   ![QGIS: Style raster]({{site.baseurl}}{{ASSET_PATH}}/images/lesson-1/lesson-1-13.png)

You've just successfully imported a vector, added and calculated a new field, styled a vector layer, rasterized a vector with GDAL, and finished it off with styling a raster. 

Keep this reclassified and rasterized vector, it'll be used in the next lesson.

<br>

----

<br>

## Vector and Raster Analysis

> notes: move Download Census and Download TIGER to Data Collection.

> notes: create separate lesson for joining tabular data in QGIS

> notes: create separate lesson for joining joined tabular data to vector data

> notes: create separate lesson for intersecting vector with joined tabular data with raster

### What this module covers:

 * Downloading Census Amerian FactFinder data
 * Downloading Census TIGER boundary data
 * Wrangling Census tabular data
 * Importing non-spatial data into QGIS
 * Joining Census housing data (home values) to Census tracts (shapefile)/joining non-spatial tabular data to vector spatial data
 * Intersecting raster and vector layers

### Objectives:

Download Census tabular data and shapefile. Join two sets of Census tabular data to a shapefile.

### Data Collection: 

 * <a href="http://factfinder.census.gov/" alt="Spatial Data Bootcamp: Download Census housing data - American FactFinder" target="_blank">Census housing data - American FactFinder</a>
 * <a href="https://www.census.gov/geo/maps-data/data/tiger.html" alt="Spatial Data Bootcamp: Download Census tract shapefile - TIGER data" target="_blank">Census tracts - TIGER Data</a>

#### Downloading data from American FactFinder (Census):

<!--1. Download Census American FactFinder housing data:
  * Open the <a href="http://factfinder.census.gov/" alt="Spatial Data Bootcamp: Download Census housing data - American FactFinder" target="_blank">Census American FactFinder site</a> and select <em>Guided Search > Get Me Started</em>.<br>
  ![Spatial Data Bootcamp: Vector & Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-1.png)
  * Step 1: Choose from one of the following. Click *Next*:<br>I'm looking for information from a specific *dataset*<br>Click *NEXT*<br>
  ![Spatial Data Bootcamp: Vector & Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-2.png)
  * Step 2: Search the dataset you're interested in. Click *Next*.<br>Select a program: *American Community Survey*<br>Select a dataset: *2013 ACS 5-year estimates*<br>*ADD TO YOUR SELECTIONS*<br>Click *NEXT*<br>
  ![Spatial Data Bootcamp: Vector & Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-3.png)
  * Step 3: Select the topic(s) you're interested in. Click *Next*.<br>Basic Count/Estimate: *Housing Units*<br>Financial Characteristic: *Value of Home*<br>Click *NEXT*<br>
  ![Spatial Data Bootcamp: Vector & Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-4.png)
  * Step 4: Add one or more geographic areas (states, cities, towns, etc.) to Your Selections. Click *Next*.<br>Select a geographic type: *.... ....Census Tract*<br>Select a state: *Washington*<br>Select a county: (leave blank)<br>Select one or more geographic areas: *All Census Tracts within Washington*<br>*ADD TO YOUR SELECTIONS*<br>Click *NEXT*<br>
  ![Spatial Data Bootcamp: Vector & Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-5.png)
  * Step 5: There are no race or ethnic groups available based upon the contents of 'Your Selections'.<br>Click *NEXT*<br>
  ![Spatial Data Bootcamp: Vector & Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-6.png)
  * Step 6: <em>Skipped</em>
  * Step 7: Select a table, file or document from these top search results:<br>Click first row in table: *SELECTED HOUSING CHARACTERISTICS* DP04 2013 ACS 5-year estimates<br>
  ![Spatial Data Bootcamp: Vector & Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-7.png)
  * Step 8: Table Viewer<br>
  ![Spatial Data Bootcamp: Vector & Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-8.png)
  * Now you need to remove unneccessary data:<br>*Modify Table* ![Spatial Data Bootcamp: Vector & Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-9.png)<br>
-->

The following method allows for less data wrangling (although it does involve two joins). We're going to download Washington housing units and home value data individually and join them. If you go through the Guided Search then you'll end up having to wrangling more than you want (remove lots of unneccessary data).

##### **1. Download Census American FactFinder housing data:**

* Open the <a href="http://factfinder.census.gov/" alt="Spatial Data Bootcamp: Download Census housing data - American FactFinder" target="_blank">Census American FactFinder site</a> and select <em>Advanced Search > SHOW ME ALL</em>.<br>
  ![Spatial Data Bootcamp: Download Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-1.png)
* You are now viewing the *ADVANCED SEARCH*. Search - Use options on the left (topics, geographics, ...) to narrow your search results.<br>
  ![Spatial Data Bootcamp: Download Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-2.png)
* Download *Washington Housing Units*:<br>
  Add *Housing Units* to query:<br>
1. Click *Topics* on the left-hand menu<br>
2. Select Topics to add to 'Your Selections'<br>
3. Housing > Basic Count/Estimate > Click *Housing Units*<br>
4. Click *CLOSE* (top right)<br>
  ![Spatial Data Bootcamp: Download Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-3.png)<br>
Add *Washington Census Tract* to query:<br>
1. Click *Geographies* on left-hand menu<br>
2. Select a geographic type: *.... ....Census Tract -140*<br>
3. Select a state: *Washington*<br>
4. Select one or more geographic areas: *All Census Tracts within Washington*<br>
*ADD TO YOUR SELECTIONS*<br>
Click *CLOSE* (top right)<br>
  ![Spatial Data Bootcamp: Download Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-4.png)<br>
Check row: *B25001 HOUSING UNITS 2013 ACS 5-year estimates*<br>
Click *Download* at the bottom of the table<br>
  ![Spatial Data Bootcamp: Download Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-5.png)
Click *OK* to create a zip file containing your selected products.<br>
  ![Spatial Data Bootcamp: Download Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-6.png)
Click *DOWNLOAD* to download zipped files<br>
  ![Spatial Data Bootcamp: Vector & Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-7.png)
Do not clear all selections.
* Download *Washington Value of Homes*:<br>
If you did not clear your selections from the previous steps then continue on, else seet **Download Washington Housing Units** above.<br>
1. Remove *Housing Units* from selection<br>
  ![Spatial Data Bootcamp: Download Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-8.png)
2. Click *Topics* on the left-hand menu and navigate to *Value of Home*:<br>*Housing > Financial Characteristic > Value of Home (click to select) > Click CLOSE (top right)*<br>
  ![Spatial Data Bootcamp: Download Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-9.png)
3. Check row: *B25077 MEDIAN VALUE (DOLLARS) 2013 ACS 5-year estimates*
  ![Spatial Data Bootcamp: Download Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-10.png)
4. Click *Download* (bottom of table) to download zipped files<br>
  ![Spatial Data Bootcamp: Download Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-11.png)
5. Click *OK* to create a zip file containing your selected products<br>
  ![Spatial Data Bootcamp: Download Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-12.png)
6. Click *Download* to save the file to your computer. This zip file will be named the same as the one above, your browser will append (1).<br>
  ![Spatial Data Bootcamp: Download Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-census/vector-census-13.png)

##### **2. Download TIGER Census Tracts:**

 1. Open the <a href="https://www.census.gov/geo/maps-data/data/tiger.html" alt="Spatial Data Bootcamp: Download Census tract shapefile - TIGER data" target="_blank">Census TIGER data site</a> and click on TIGER/Line Shapefiles from the product table.<br>
  ![Spatial Data Bootcamp: Download TIGER data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-tiger/vector-tiger-1.png)
 2. In the product year table, select *2014*, click *Download*, and enter the *Web Interface*<br>
  ![Spatial Data Bootcamp: Download TIGER data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-tiger/vector-tiger-2.png)
 3. Select a layer type: *Census Tracts*, then *Submit*<br>
  ![Spatial Data Bootcamp: Download TIGER data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-tiger/vector-tiger-3.png)
 4. Census Tract - Select a state: *Washington*, then *Download*<br>
  ![Spatial Data Bootcamp: Download TIGER data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-tiger/vector-tiger-4.png)
 5. Save file. Navigate to your directory<br>
  ![Spatial Data Bootcamp: Download TIGER data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-tiger/vector-tiger-5.png)

##### **3. Unpack downloaded files:**

If you haven't already downloaded your data, see **Download Census Housing Data** and **Download TIGER Census Tracts** above.

If you haven't already moved your downloaded zip files from the above steps, move your zip files into your working directory.

Using an extraction application like 7-zip makes it easy to unzip these files.

Install 7-zip if necessary.

Right-click on zip file and 'Extract Here'

Do this for all zip files.

![Spatial Data Bootcamp: Unzip files]({{site.baseurl}}{{ASSET_PATH}}/images/vector-tiger/vector-unpack-files.png)

After unpacking files, open one of the Census ACS folders (aff_download).

Rename folder 

Notice the files. Theres a text file with metadata on the given metric (Housing Units or Home Values). There's a README that explains what's inside of the zip file. There's a metadata CSV that explains what the column headings represent. And there's the data we need in CSV format with annotations.

Now open the Census tracts TIGER data folder. The XMl file contain the metadata about the shapefile. Double-clicking the XML files should open in a web browser and you should be able to read the information. The shapefile data is stored in the .dbf, .prj, .shp, and .shx. You can view the projection by opening the .prj in a text editor. Don't bother trying to open the other files in a text editor.

![Spatial Data Bootcamp: View shapefiles and metadata]({{site.baseurl}}{{ASSET_PATH}}/images/vector-tiger/vector-unpack-files-2.png)

##### **4. Join Census Housing Data to TIGER Census Tracts**

1. Import Census Tracts shapefile **tl_2014_53_tract** ![Spatial Data Bootcamp: Census Join - Add vector layer]({{site.baseurl}}{{ASSET_PATH}}/images/qgis/add-vector.png).<br>
![Spatial Data Bootcamp: Census Join - Washington Census tracts]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-1.png)
1. Rename tl_2014_53_tract to census-tracts *Right-click layer > Rename*.
1. Open the tract **Attribute table** and leave it open: *Right-click tract layer > Attribute table*<br>
![Spatial Data Bootcamp: Census Join - Washington tract attributes]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-2.png)
1. If you haven't yet, download your Census data and return to this step. SEE *ENTER EXERCISE NUMBER AND LINK HERE*<br>
1. Navigate to the Census Housing Units directory. You should have a soure_files directory with Census Housing Units, Census Home Values, and Census Tracts zip files and unzipped folders containing data.<br>
![Spatial Data Bootcamp: Census Join - Washington Census data]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-3.png)
1. *Rename ACS_13_5YR_B25001_with_ann.csv to housing-units.csv*
![Spaital Data Bootcamp: Census Join - Rename housing data CSV]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-4.png)
1. Open housing-units.csv and inspect the data for columns to use for our joins. HINT: it's GEOID (tract shapefile) and GEO.id2 (ACS CSVs). We can only join data (tabular join) with *exact same* columns. The Census provides these columns for this purpose (I'm sure other purposes as well). See the tables below:<br>
![Spatial Data Bootcamp: Census Join - Locate similar columns]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-5.png)
1. Remove the second row containing the annotations. Delete the columns: GEO.id, GEO.display-lable, and HD02_VD01. For the purposes of this exercise, we do not need the removed columns. Our objective is to join data and visualize (with minimal data wrangling). In LibreOffice, highlight the row/column, right-click and Delete Selected Columns. Excel should be the same/similar. Command-line users, AWK is an easy solution. It should look like the file below:<br>
![Spatial Data Bootcamp: Census Join - Delete housing data annotation]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-6.png)
1. Rename header HD01_VD01 to TotalUnitsHome. Save your document, be sure it's stored as a Text CSV ![Spatial Data Bootcamp: Census Join - Save as Text CSV]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-8.png). Excel users may have to select Text CSV from a drop-down list (I'll check back with this). Renaming the headers reduced confusion down the road. Also, notice how there are no spaces in the header name. Removing (or not having) spaces is in the top 10 list of best naming convention practices (on all computer systems.. everywhere in the digital world.. you should never have spaces in your file names or directories). Close the document.<br>
![Spatial Data Bootcamp: Census Join - Rename HD01_VD01 to MeanValueHome]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-7.png)
1. Do the same for the Home Values CSV:
* Navigate to document
* Rename ACS_13_5YR_B25077_with_ann.csv to home-values.csv
* Delete second row with annotations
* Delete columns: GEO.id, GEO.display-label, HD02_VD01
* Rename HD01_VD01 to MedianValueHome
* Save your document in Text CSV format ![Spatial Data Bootcamp: Census Join - Save as Text CSV]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-8.png)<br>
![Spatial Data Bootcamp: Census Join - Wrangle Home Values CSV]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-9.png)
1. You're not quite finished with wrangling your data yet. If you have a quick look at your home-values.csv (it should still be open, Simon didn't say close!), you'll notice there are some invalid fields - number fields that contain non-numeric values. Lines 501 and 502 read 1,000,000+ and should be changed to 1000000.<br>
![Spatial Data Bootcamp: Census Join - Wrangle Home Values CSV]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-10.png)
There are some median home value records with '-' and if you read your metadata you would know that:<br><br>*An '-' entry in the estimate column indicates that either no sample observations or too few sample observations were available to compute an estimate, or ratio of medians cannot be calculated because of one or both of the median estimates falls in the lowest interval or upper interval of an open-ended distribution.*<br><br>Let's cleanse this now:<br> LibreOffice and Excel users, **Find and Replace '-' (without single quotes) with NULL**<br>VIM (or similar) users: **%s#-#NULL#g**<br><br>Also, after making these changes the data type of the incorrect records have not changed - they're still string/text fields in a numeric universe (only in LibreOffice/Excel, however). We will instruct QGIS on how to read the column data types with a .CSVT. Be sure to save your home-values.csv in Text CSV format ![Spatial Data Bootcamp: Census Join - Save as Text CSV]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-8.png).
![Spatial Data Bootcamp: Census Join - Wrangle Home Values CSV]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-11.png)
1. Just wait right there, one does not simply join a string (tract's GEOID) to a number (ACS's GEO.ids). We now have to create our CSVTs (one for each home-values.csv and housing-units.csv). As a reminder, these indicate to QGIS the data types of each column of repsective CSVs. Our goal here is to join GEOID from tracts (shapefile) to GEO.id2 from home-values.csv and housing-units.csv. Go back into QGIS and open the census-tracts properties and navigate to **Fields**. Locate GEOID in the table and notice its **Type name** - **String**. With less wrangling we can make GEO.id2 a string for joining purposes. Close the properties window. The following steps outline how to create the CSVTs.<br>
![Spatial Data Bootcamp: Census Join - Tract field data types]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-12.png)
1. Open a text editr (gedit, VIM, notepad, notepad++) and enter the following row:<br>
"String","Real(12.0)"<br>
![Spatial Data Bootcamp: Census Join - Creating a CSVT]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-13.png)
What this means:<br>
There are two columns in this file separated by a common. The first column indicates string and the second is a real number with length of 12 and precision of 0. While preparing this exercise, QGIS didn't like multiplying integers (Field Calculator results with NULL), so we're using real number type. 0 precision removes unneccessary zeros after the decimal from real number types, also there are no fractions in the datasets.<br><br>
* Save this file as *home-values.csvt* within the *same* directory as *home-values.csv*<br><br>
1. Luckily, we wrangled both CSVs into the same format, so copy *home-values.csvt* and paste it into the *same* directory as *housing-units.csv*. Rename this pasted file as *housing-units.csvt*. Data types, lengths, and precisions will be the same for both files.<br>
![Spatial Data Bootcamp: Census Join - Viewing housing-units.csvt]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-14.png)
1. Import CSVs into QGIS. Don't move just yet, there a little quirk about importing CSVs with CSVTs into QGIS. You *cannot* use the **Add Delimited Text Layer** tool, this does not recognize the CSVT precision and length. The best way to import with CSVTs is the ol' drag-n-drop method (this has only been tested on Ubuntu 14.04 as of yet). Drag-and-drop your housing-units.csv and home-values.csv into QGIS. Don't touch the associated CSVTs, QGIS reads these during the import process, just *don't* move these files. It's the same concept as shapefiles and the multitude of associates files per one shapefile.<br>
![Spatial Data Bootcamp: Census Join - Drag and drop CSVs]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-15.png)
1. Your workspace should look like the image below. Save your workspace now.<br>
![Spatial Data Bootcamp: Census Join - Workspace]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-16.png)
1. Now we are able to join our Census tabular data to the tracts shapefile. Join data by opening the **Properties** of the census-tracts layer and navigating to the **Joins** tab.<br>
![Spatial Data Bootcamp: Census Join - view tracts properties]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-17.png)
1. Start the first join by clicking the green plus sign ![Spatial Data Bootcamp: Census Join - green plus sign]({{site.baseurl}}{{ASSET_PATH}}/images/qgis/join-plus.png). We're joining home-values and housing-units to census-tracts with:<br>**Join field: GEO.id2<br>Target field: GEOID<br>Cache join layer in virtual memory: (checked)<br>Apply and OK onced both joined**<br>
![Spatial Data Bootcamp: Census Join - joining data]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-18.png)
1. Open census-tracts **Attribute Table** and locate the MeanValueHome and TotalUnitsHome fields. Notice they've been renamed and cut-down. We can still decrypt these headings so we'll continue on. Close the attributes table.<br>
![Spatial Data Bootcamp: Census Join - viewing joined data]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-19.png)
1. You have joined the data but it's currently being stored in the virtual memory, so we need to save census-tracts (with joined data) as a new shapefile: *Right-click shapefile > Save As*<br>
**Format: ESRI Shapefile<br>
Save as: tracts-values-units (save in your project directory)<br>
Add saved file to map: (checked)**<br>
![Spatial Data Bootcamp: Census Join - save shapefile]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-20.png)
1. Let's now calculate total housing value per census tract (TotalUnitsHome X MedianValueHome). 
* **Open tracts-value-units attributes table > Toggle editing mode** ![Spatial Data Bootcamp: Census Join - toggle edits]({{site.baseurl}}{{ASSET_PATH}}/images/qgis/toggle-editing-mode.png) **> Field Calculator** ![Spatial Data Bootcamp: Census Join - field calculator]({{site.baseurl}}{{ASSET_PATH}}/images/qgis/field-calculator.png). 
* Configure Field Calculator inputs as follows:<br>
**Create a new field: (checked)**<br>
**Output field name: TotalValue**<br>
**Output field type: Decimal number (real)**<br>
**Output field width: 20**<br>
**Precision: 0**<br>
**Expression: "home-value" * "housing-un"**<br><br>
![Spatial Data Bootcamp: Census Join - field calculator]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-21.png)
1. Locate **TotalValue** and confirm the calculation. NOTE: you should still have NULL values given that home-values.csv contains NULL values. Be sure to *Save edits* ![Spatial Data Bootcamp: Census Join - save edits]({{site.baseurl}}{{ASSET_PATH}}/images/qgis/save-edits.png) and disable editing mode (Toggle editing mode) ![Spatial Data Bootcamp: Census Join - toggle editing mode]({{site.baseurl}}{{ASSET_PATH}}/images/qgis/toggle-editing-mode.png). The editing options should now be grayed-out and disabled.<br>
![Spatial Data Bootcamp: Census Join - TotalValue per tract]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-22.png)
1. You've successfully joined two sets of Census tabular data to a shapefile. 
1. Style tracts-values-units by categorizing by TotalValue and select a color ramp. QGIS will inform you that you have a high number of classes, click OK to confirm the categorization. We'll need to remove NULL values. Locate NULL within the category table (HINT: it contains no values and is blank - look towards the bottom), highlight and click 'Delete' (not Delete all!) - 'Delete' removes only selected rows. Click Apply then OK to confirm changes. Deactivate census-tracts layer by unchecking it activate box in the layers list. Save your workspace. <br>
![Spatial Data Bootcamp: Census Join - completed]({{site.baseurl}}{{ASSET_PATH}}/images/census-join/census-join-24.png)

<br>

----

<br>

## Vector Analysis

### What this module covers: 

 * Buffer polylines
 * Join census housing (home values) to census tracts (shapefile)
 * Intersecting vector layers


### Objective: 

Quantify total home value at risk within landslide/mass-wasting and fautls.

### Data Collection: (there needs to be instructions/quick lesson on each of the collection sources) 

 * <a href="http://factfinder.census.gov/faces/nav/jsf/pages/guided_search.xhtml" alt="Spatial Data Bootcamp: Download Census housing data - American FactFinder" target="_blank">Census housing data - American FactFinder</a>
 * <a href="https://www.census.gov/geo/maps-data/data/tiger.html" alt="Spatial Data Bootcamp: Download Census tract shapefile - TIGER data" target="_blank">Census tracts - TIGER Data</a>
 * <a href="http://earthquake.usgs.gov/hazards/qfaults" alt="Spatial Data Bootcamp: Download USGS quaternary faults" target="_blank">Quaternary faults - USGS </a>
 * <a href="http://www.dnr.wa.gov/ResearchScience/Topics/GeosciencesData/Pages/gis_data.aspx" alt="Spatial Data Bootcamp: Download seismogenic features" target="_blank">Washington seismogenic features - REQUIRES GDAL filegdb driver!</a>
 * <a href="http://nhd.usgs.gov/" alt="Spatial Data Bootcamp: Download USGS National Hydrography Dataset - Washington" target="_blank">Washington streams/rivers - USGS National Hydrography Dataset</a>

 * faults_100k - [source]
 * [housing-data.zip]({{site.baseurl}}{{ASSET_PATH}}/data/housing-data.zip)

### Data Wrangling:

#### Wrangle Census Data:

Luckily, the Census data has already been wrangled. Census data can sometimes be tricky. 

#### High-risk rules:

 * within 100m of fault lines
 * within 50m of rivers/streams
 * within soft geologic areas 

 1. Open QGIS and configure project workspace.
 1. Import data:
   * HINT: The project projection will default to the first layer that is added to the project (See lower right of image below: EPSG:2927).
   * <em>Add Vector Layer: </em>![Spatial Data Bootcamp: Vector Analysis - add vector data]({{site.baseurl}}{{ASSET_PATH}}/images/qgis/add-vector.png)<br>**fault_100k.shp**<br>
   ![Spatial Data Bootcamp: Vector Analysis - streams and faults]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-3.png)
 1. Buffer fault lines to 100m:
   * <em>Menu Bar > Vector > Geoprocessing Tools > Buffer(s)</em>
   * Configure inputs as follows:<br>**Input vector layer: fault_100k<br>Buffer distance: 100<br>Output shapefile: fault_buffer_100m.shp<br>Add results to canvas: (Checked)<br>Click OK to perform analysis, Close to exit the tool**<br>
   ![Spatial Data Bootcamp: Vector Analysis - buffer analysis]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-4.png)
   * <em>Zoom in to a buffer, close enough to see the width</em>
   * <em>Open the meaure tool</em> ![Spatial Data Bootcamp: Vector Analysis - measure tool]({{site.baseurl}}{{ASSET_PATH}}/images/qgis/measure-tool.png)
   * <em>Measure the width of the buffer.</em> Notice how the total width is only about 62 meters, or 100 feet. Current map units are determined by the CRS, in this case EPSG:2927 is in US feet and we need meters. Simply changing the CRS in Project Properties does not give us the correct results- this is still measured from EPSG:2927 US feet.<br>
   ![Spatial Data Bootcamp: Vector Analysis - measure buffer]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-measure-tool-2.png)<br><br>**Important:**<br>There are two methods to perfoming a buffer analysis on our shapefile. The problem here is that our CRS is EPSG:2927 (in US feet) and the buffer distance is based on map units (still US feet). The two methods are: convert 100 meters to US feet and use this value in the buffer analysis while maintaining EPSG:2927 (in US feet); OR, reproject the layer thus creating a new file with a CRS in meters (correct map units), and then reprojecting back to EPSG:2927. We'll go with the former.<br><br>
 1. Now we need to perform the buffer analysis with the correct method. <em>Remove the incorrect buffer layer: fault_buffer_100m.shp</em>
 1. <em>Add Vector Layer: </em>![Spatial Data Bootcamp: Vector Analysis - add vector]({{site.baseurl}}{{ASSET_PATH}}/images/qgis/add-vector.png)
   * **NHD_MajorStreams.shp<br>**
  ![Spatial Data Bootcamp: Vector Analysis - add vector data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-5.png)
 1. Open the buffer tool: 
   * <em>Menu Bar > Vector > Geoprocessing Tools > Buffer(s)</em>
 1. <em>Buffer fault_100k:</em>
   * Configure inputs as follow:<br>**Input vector layer: fault_100k<br>Buffer distance: 328<br>Output shapefile: fault_buffer_100m.shp<br>Add result to canvas: (Checked)<br>Click OK to run (overwrite necessary), and CLOSE to exit tool**<br><br>**Reminder:**<br>Buffer distance = 100 meters * 3.28084 feet = 328.084 feet<br> 1 meter = 3.28084 feet<br><br>
   ![Spatial Data Bootcamp: Vector Analysis - buffer vector]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-6.png)
 1. Confirm 100 meter buffer on faults:
   * Open measure tool ![Spatial Data Bootcamp: Vector Analysis - measure tool]({{site.baseurl}}{{ASSET_PATH}}/images/qgis/measure-tool.png) and confirm 200 meter total width (100 meters * 2 = 200 meters)<br>
   ![Spatial Data Bootcamp: Vector Analysis - measure faults buffer]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-7.png)
 1. <em>Repeat buffer with NHD_MajorStreams.shp</em>
   * Configure inputs as follows:<br>**Input vector layer: NHD_MajorStreams<br>Buffer distance: 164<br>Output shapefile: streams_buffer_50m.shp<br>Add result to canvas: (Checked)<br>Click OK to run, CLOSE to exit tool**<br><br>**Reminder:**<br>Buffer distance = 50 meters * 3.28084 feet = 164.052 feet<br> 1 meter = 3.28084 feet<br><br>
   ![Spatial Data Bootcamp: Vector Analysis - buffer streams]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-8.png)
 1. Confirm 50 meter buffer on streams.
 1. Import Census housing data (wa-housing-data.csv):
    * Notice: housing-data.csv has already been wrangled.
    * Add Delimited Text Layer ![Spatial Data Bootcamp: Vector Analysis - add Census data]({{site.baseurl}}{{ASSET_PATH}}/images/qgis/add-csv.png) or <em>Menu Bar > Layer > Add Delimited Text Layer</em>
    * Configure inputs as follows:<br>**File Name: housing-data.csv<br>File Format: CSV<br>First record has field names: (Checked)<br>No geometry (attribute only table): (Selected)<br>OK to add** 
   ![Spatial Data Bootcamp: Vector Analysis - add Census data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-9.png)
 1. View Census housing-data.csv:
   * <em>Right-click housing-data (in layer list) > Open attribute table</em>
 1. Import Washington Census tracts (tl_2014__53_tract.shp) ![Spatial Data Bootcamp: Vector Analysis - add Census tracts]({{site.baseurl}}{{ASSET_PATH}}/images/qgis/add-vector.png)<br>
   ![Spatial Data Bootcamp: Vector Analysis - add Census tracts]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-10.png)<br><br>**Important:** Did you check the projection of the Census tracts shapefile? Be sure your shapefile CRS is EPSG:2927. <br><br>'on the fly' projection is selected
 1. Save Census tract (tl_2014_53_tract.shp) with ESPG:2927:
   * <em>Right-click tl_2014_53_tract.shp (layer list) > Save As</em>
   * Configure as follows: **ESRI Shapefile with EPSG:2927, Output filename: wa-tracts.shp, Add saved file to map: (Checked)**
 1. <em>Remove current tl_2014_53_tract.shp</em><br>
  ![Spatial Data Bootcamp: Vector Analysis - workspace]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-11.png)
 1. Open wa-tracts attribute table and housing-data to find the key that will be used to join the tables. HINT: It's GEOID and GEO.id2.<br><br>**notes:** discuss field types, e.g. cannot compare a string to a number. -- add image --<br><br>
 1. Join Census housing data (housing-data.csv) to Census tracts (wa-tracts.sho):
   * Open Processing Toolbox (<em>Menu Bar > Processing > Toolbox</em>), search for "join attributes table", then double-click "Join attributes table"<br>
   ![Spatial Data Bootcamp: Vector Analysis - join attribute table]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-12.png)
   * Configure Join attributes table as follows:<br>**Input layer: wa-tracts<br>Input layer 2: housing-data<br>Table field: GEOID<br>Table field 2: GEO.id2<br>Output layer: (Save to file..) tracts-housing-data.shp**<br><br>**IMPORTANT:** The concept behind this join is tabular (non-locational-data) joined to spatial data, not spatial data to tabular data. So, you must have spatial data (wa-tracts.shp) as the primary input and tabular data (housing-data.csv) as the secondary input. Notice in the **Joing attributes table** inputs below.<br>![Spatial Data Bootcamp: Vector Analysis - join Census tracts and housing data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-13.png)<br><br> **NOTICE:** "Layers do not all use the same CRS. This can cause unexpencted results." Remember, the housing-data.csv does not have any locational data associated with it. Click Yes, to continue.<br><br>![Spatial Data Bootcamp: Vector Analysis - join error]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-14.png)
 1. Confirm output: housing data joined to tracts. Output is named "Output layer", rename to "tracts_housing_data.shp" (<em>right-click layer > Rename</em>). Hover over the layer in the layer list to view the source path.
 ![Spatial Data Bootcamp: Vector Analysis - tracts and housing data joined]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-15.png)
 1. Normalize housing data - tract house count X median tract house value = total tract home value: (you'll need point data to have a more accurate analysis)
   * <em>Right-click tracts_housing_data > Open Attribute Table > Toggle editing mode > Open field calculator</em>
   * If you had downloaded the original ACS .csv with annotations then you would be able to easily find what the column headers mean. Or, you could locate the ACS metadata. But we have provided the difinitions below:<br>HC01_VC118 = Total Housing Units (Owner-occupied)<br>HC01_VC127 = Estimated Median Housing Unit (Owner-occupied)<br>We would have calculated total housing * median housing (total) but the ACS does not provide these metrics.
   * Configure inputs as follows:<br>![Spatial Data Bootcamp: Vector Analysis - normalize data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-16.png)
   * View your ouputs. Notice there are some NULL values:<br>![Spatial Data Bootcamp: Vector Analysis - noramlize data]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-17.png)
 1. intersect buffered-merged-joined data with reclassified-rasterized geology layer
  * intersect buffered faults and streams:<br>
  ![Spatial Data Bootcamp: Vector Analysis - intersect buffered streams and faults]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-18.png)
  ![Spatial Data Bootcamp: Vector Analysis - intersect buffered streams and faults]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-19.png)
 1. calculate stream_fault_intersection shape area:
  ![Spatial Data Bootcamp: Vector Analysis - calculate shape area]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-20.png)
  ![Spatial Data Bootcamp: Vector Analysis - calculate shape area]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-21.png)
 1. calculate tracts_housing shape area:
  ![Spatial Data Bootcamp: Vector Analysis - calculate shape area]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-22.png)
 1. spatial join stream_fault_intersection + tracts_housing: (this one takes a while)
  ![Spatial Data Bootcamp: Vector Analysis - spatially join stream_fault_intersection to wa-tracts]({{site.baseurl}}{{ASSET_PATH}}/images/vector-analysis/vector-analysis-23.png)
 1. data will be used in Raster Analysis

<br>

----

<br>

## Raster Analysis

### What this module covers: 

  * Importing raster data
  * DEM Terrain analysis (slope, aspect)
  * Raster analysis using Raster Calculator

### Objective:

Complete locating high-risk landslide/mass-wasting areas in Washington. You must use the digital elevation model (DEM) that you created in [Data Wrangling - DEM]({{site.baseurl}}/applications/qgis#data-wrangling---prepare-digital-elevation-model) to produce slope and aspect rasters. Lastly, you need perforam a raster summation for locating high-risk landslide areas.

### Data:

 * Washington DEM (wa_dem.tif) - [SEE Data Wrangling]({{site.baseurl}}/applications/qgis#data-wrangling---prepare-digital-elevation-model) 
 * Washington geology raster (wa_geology.tif) - [SEE Data Wrangling]({{site.baseurl}}/applications/qgis#data-wrangling---reclassify-and-rasterize-vector)

### Data Classifications:

#### High-risk slope:

| Category| &nbsp;&nbsp;&nbsp;&nbsp; | Slope |
|:-:|-|:----------:|
| 1 || < 3&deg;   |
| 2 || 3-5&deg;   |
| 3 || 5-10&deg;  |
| 4 || 10-15&deg; |
| 5 || 15-20&deg; |
| 6 || 20-30&deg; |
| 7 || 30-40&deg; |
| 8 || > 40&deg;  |

#### Geology strength:

| Category| &nbsp;&nbsp; | Strength|
|:-:|-|:----:|
| 1 || Low (high-risk) |
| 2 || Medium          |
| 3 || High (low-risk) |

### Steps:

 1. Import raster data:
  * <em>Open QGIS > Add Raster Layer > Data directory > Add: wa_dem.tif and wa_geology.tif</em><br>
  * BEST PRACTICE: Check your projections before performing any anaylsis, otherwise you're in for a lot of trouble. Also, check raster resolutions before analysis, you don't want your results to be off or invalid.<br>
  ![Spatial Data Bootcamp: Raster Analysis - import raster data]({{site.baseurl}}{{ASSET_PATH}}/images/raster-analysis-1.jpg)
 1. Style wa_geology.tif to help better visualize data:
  * <em>Right-click layer > Properties > Style</em>
  * Render type: Singleband pseudocolor
  * Generate new color map: select color map
  * Mode: Equal interval = 3
  * Set Max = 3
  * Load min/max values: Min/max
  * Accuracy: Actual (slower)
  * <em>Click Classify</em> to enable changes.
  ![Spatial Data Bootcamp: Raster Analysis - style raster data]({{site.baseurl}}{{ASSET_PATH}}/images/raster-analysis-2.jpg)
  * To change individual value colors, <em>double-click the color box</em> of the desired value:<br>
  ![Spatial Data Bootcamp: Raster Analysis - style raster data]({{site.baseurl}}{{ASSET_PATH}}/images/raster-analysis-3.jpg)
  * Click Apply and OK to save changes.
  * Notice how the layer label has changed from 1-2.998 to 1-3.
  * Also, notice some geology raster pixel values are missing (you can see wa_dem black values), this is due to a no-data value assigned to water. Water != geology.<br>
  ![Spatial Data Bootcamp: Raster Analysis - style raster data]({{site.baseurl}}{{ASSET_PATH}}/images/raster-analysis-4.jpg)
 3. Calculate slope:
  * <em>Menu Bar > Raster > Analysis > DEM (Terrain models)</em>
  * **Configure as follows:<br><br>Input file (DEM raster): wa_dem<br>Output file: slope.tif<br>Mode: Slope<br>Scale: 0.30<br><br>**
  * explain scale = 0.30<br>
  ![Spatial Data Bootcamp: Raster Analysis - DEM Terrain Analysis - Slope]({{site.baseurl}}{{ASSET_PATH}}/images/raster-analysis-5.jpg)
  * Click OK, OK, CLOSE to exit DEM (Terrain models)<br>
  ![Spatial Data Bootcamp: Raster Analysis - DEM Terrain Analysis - Slope]({{site.baseurl}}{{ASSET_PATH}}/images/raster-analysis-6.jpg)
 4. Reclassify slope raster
  * Enable the Processing Toolbox: <em>Menu Bar > Processing > Toolbox > Select Advanced interface</em><br>
  ![Spatial Data Bootcamp: Raster Analysis - Reclassify slope raster]({{site.baseurl}}{{ASSET_PATH}}/images/raster-analysis-7.jpg)
  * The <em>r.reclass</em> tool will be used to reclassify the slope raster into correct categories. Create a text file with the following data. Save it as slope-rule.txt.
 
#####*slope-rule.txt*
~~~
0 thru 2.99 = 1
3 thru 4.99 = 2
5 thru 9.99 = 3
10 thru 14.99 = 4
15 thru 19.99 = 5
20 thru 29.99 = 6 
30 thru 39.99 = 7
40 thru 90 = 8
~~~
  ![Spatial Data Bootcamp: Raster Analysis - Reclassify slope raster]({{site.baseurl}}{{ASSET_PATH}}/images/raster-analysis-8.jpg)

  * Open GRASS tool, r.reclass: <em>Processing Toolbox (with Advanced interface) > GRASS Commands > Raster > r.reclass</em>
  * Configure your inputs as follows:**<br><br>Input Raster: slope<br>File containing reclass rules: slope-rules.txt<br>Output raster layer: slope-reclass.tif** (NOTE: select <em>Save to file...</em> or QGIS will not create a permanent output)<br><br>
  ![Spatial Data Bootcamp: Raster Analysis - reclassified slope output]({{site.baseurl}}{{ASSET_PATH}}/images/raster-analysis-slope-reclass-inputs.png)

We will have to do some raster calculations to create the output data set. The classifications are taken from the California study[^2] and are as follows:

![landslide-key]({{site.baseurl}}{{ASSET_PATH}}/images/landslide-key.png)

Since we need to cross reference these categories, we need to create a raster which represents each unique combination of the slope and rock strength classes. A method to create unique combinations is to promote the rock strength categories a decimal place. This would make the rock classes: 10,20, and 30.

To create these new classes, we can load the source_files/geo_coded.tif, and secondary_files/slope_reclass.tif

In the top menu, select *Raster* > *Raster Calculator*

Our raster calculator expression will be: 

{% highlight bash %}
("geo_coded@1" * 10) + "slope-reclass@1"
{% endhighlight %}

Output layer: slope-geo-sect.tif

![raster-calc]({{site.baseurl}}{{ASSET_PATH}}/images/raster-calc.png)


We can apply the landslide susceptibility classification using r.reclass and the following rule file:

*landslide-rule.txt*

~~~
11 12 13 21 31 = 0
14 = 3
22 23 = 5
15 = 6
16 32 33 = 7
17 18 24 = 8
25 thru 28 34 = 9
35 thru 38 = 10
~~~


####Precipitation

Now that we have created the landslide susceptibility layer, we can make use the Average Annual Precipitation layer to check the susceptible areas against the areas receiving the most annual rain.



Convert millimeters to inches


Raster calculator: precip = precip * 0.0394

Check THIS STEP AGAINST REFERENCES


| Category |&nbsp;&nbsp;&nbsp;&nbsp; | Precipitation |
|:--------:|-|:-------:|
|   0
|   1      || 5-10 in  |
|   2      || 10-15 in |
|   3      || 15-30 in |
|   4      || 30-45 in |
|   5      || 45-60 in |
|   6      || 60-75 in |
|   7      || 75-90 in |
|   8      || > 90 in  |

----

### Raster Statistics: 

 * histogram
 * zonal stats

----

### Visualization

Now that the output datasets have been created, we can work on making our results presentable.

----

Explain what was covered.

<br>

----

<br>

References: 

[^1]: [http://qgis.org](http://www.qgis.org)

[^2]: [http://docs.qgis.org/2.6/en/docs/index.html](http://docs.qgis.org/2.6/en/docs/index.html)

[^3]: [http://www.gdal.org/gdal_rasterize.html](http://www.gdal.org/gdal_rasterize.html)
